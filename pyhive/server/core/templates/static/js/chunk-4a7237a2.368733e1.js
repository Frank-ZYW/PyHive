(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a7237a2"],{"4d46":function(t,e,n){},5933:function(t,e,n){"use strict";var a=n("4d46"),s=n.n(a);s.a},dfbd:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"panel"},[n("el-dialog",{staticClass:"dialog",attrs:{visible:t.intervalsDialog,size:"tiny",width:"500px"},on:{"update:visible":function(e){t.intervalsDialog=e}}},[n("el-form",{attrs:{"label-width":"140px"}},[n("el-form-item",{attrs:{label:t.$lang.columns.intervals}},[n("el-input",{attrs:{placeholder:t.$lang.columns.days},model:{value:t.intervals,callback:function(e){t.intervals=e},expression:"intervals"}})],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.intervalsDialog=!1}}},[t._v("\n\t\t\t\t"+t._s(t.$lang.buttons.cancel)+"\n\t\t\t")]),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.onSpiderIntervalsUpdte}},[t._v("\n\t\t\t\t"+t._s(t.$lang.buttons.save)+"\n\t\t\t")])],1)],1),n("panel-title",{attrs:{title:t.$lang.objects.spiders}},[n("el-input",{staticStyle:{width:"160px","margin-right":"10px"},attrs:{placeholder:t.$lang.inputs.search,"prefix-icon":"el-icon-search",size:"mini"},on:{input:t.onGetSpiderData},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),n("el-button",{attrs:{size:"mini"},on:{click:t.onRefresh}},[n("i",{staticClass:"fa fa-refresh"}),t._v("\n\t\t\t"+t._s(t.$lang.buttons.refresh)+"\n\t\t")])],1),n("div",{staticClass:"panel-body"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"empty-text":t.$lang.messages.noData,data:t.spiders,"element-loading-text":t.$lang.messages.loading,"row-class-name":t.tableRowClassName,"max-height":"700"}},[n("el-table-column",{attrs:{align:"center",prop:"id",label:t.$lang.columns.id,width:"80"}}),n("el-table-column",{attrs:{align:"center",label:t.$lang.columns.name,width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t"+t._s(e.row.name)+"\n\t\t\t\t\t"),e.row.available?n("el-badge",{staticClass:"mark",staticStyle:{"margin-left":"3px"},attrs:{type:"success",value:t.$lang.buttons.normal}}):n("el-badge",{staticClass:"mark",staticStyle:{"margin-left":"3px"},attrs:{type:"danger",value:t.$lang.buttons.error}})]}}])}),n("el-table-column",{attrs:{align:"center",label:t.$lang.columns.project,width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("i",{staticClass:"el-icon-document-copy",staticStyle:{"margin-right":"6px"}}),n("span",[t._v(t._s(e.row.project_name))])]}}])}),n("el-table-column",{attrs:{align:"center",prop:"manual",label:t.$lang.columns.runMode,width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.manual?n("span",{staticStyle:{color:"#9c9c9c","margin-right":"8px"}},[t._v(t._s(t.$lang.selects.manual))]):n("span",{staticStyle:{color:"#9c9c9c","margin-right":"8px"}},[t._v(t._s(t.$lang.selects.auto))]),n("el-switch",{attrs:{"active-color":"#E6A23C","inactive-color":"#60BCFE","active-value":!0,"inactive-value":!1},on:{change:function(n){return t.onSpiderRunModeUpdte(e.row)}},model:{value:t.spiders[e.$index].manual,callback:function(n){t.$set(t.spiders[e.$index],"manual",n)},expression:"spiders[props.$index].manual"}})]}}])}),n("el-table-column",{attrs:{align:"center",label:t.$lang.columns.nextTime,width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-progress",{attrs:{percentage:t.calculatePercent(e.row),color:"#35CBAA","show-text":!1}})]}}])}),n("el-table-column",{attrs:{align:"center",label:t.$lang.columns.status,width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[2===t.spidersStatus[e.row.id]?n("span",{staticStyle:{color:"#409EFF","font-weight":"bold"}},[n("i",{staticClass:"fa fa-circle",staticStyle:{"margin-right":"5px"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.$lang.buttons.finished)+"\n\t\t\t\t\t")]):1===t.spidersStatus[e.row.id]?n("span",{staticStyle:{color:"#67C23A","font-weight":"bold"}},[n("i",{staticClass:"el-icon-loading",staticStyle:{"margin-right":"5px"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.$lang.buttons.running)+"\n\t\t\t\t\t")]):0===t.spidersStatus[e.row.id]?n("span",{staticStyle:{color:"#E6A23C","font-weight":"bold"}},[n("i",{staticClass:"el-icon-loading",staticStyle:{"margin-right":"5px"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.$lang.buttons.connecting)+"\n\t\t\t\t\t")]):-1===t.spidersStatus[e.row.id]?n("span",{staticStyle:{color:"#E6A23C","font-weight":"bold"}},[n("i",{staticClass:"el-icon-loading",staticStyle:{"margin-right":"5px"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.$lang.buttons.pending)+"\n\t\t\t\t\t")]):n("span",{staticStyle:{color:"#F56C6C","font-weight":"bold"}},[n("i",{staticClass:"fa fa-circle",staticStyle:{"margin-right":"5px"}}),t._v("\n\t\t\t\t\t\t"+t._s(t.$lang.buttons.noJob)+"\n\t\t\t\t\t")])]}}])}),n("el-table-column",{attrs:{align:"center",label:t.$lang.columns.operations},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:t.$lang.tags.run,placement:"top"}},[n("el-button",{staticStyle:{color:"#35CBAA"},attrs:{type:"text",size:"mini",icon:"fa fa-play fa-2x",disabled:t.operationsEnable("run",e.row)},on:{click:function(n){return t.onStartSpider(e.row.id)}}})],1),n("span",{staticStyle:{"margin-right":"40px"}}),n("el-tooltip",{attrs:{content:t.$lang.tags.cancel,placement:"top"}},[n("el-button",{staticStyle:{color:"#EF6372"},attrs:{type:"text",size:"mini",icon:"fa fa-times fa-2x",disabled:t.operationsEnable("cancel",e.row)},on:{click:function(n){return t.onCancelJob(e.row.id)}}})],1),n("span",{staticStyle:{"margin-right":"40px"}}),n("el-tooltip",{attrs:{content:t.$lang.tags.intervals,placement:"top"}},[n("el-button",{staticStyle:{color:"#606266"},attrs:{type:"text",size:"mini",icon:"fa el-icon-alarm-clock fa-2x"},on:{click:function(n){return t.onJobIntervals(e.row)}}})],1),n("span",{staticStyle:{"margin-right":"40px"}}),n("router-link",{attrs:{to:{name:"SpiderMonitor",params:{spiderInfo:e.row}},tag:"span"}},[n("el-tooltip",{attrs:{content:t.$lang.tags.monitor,placement:"top"}},[n("i",{staticClass:"fa-2x el-icon-notebook-2"})])],1)]}}])})],1)],1)],1)},s=[],i=(n("6b54"),n("ac6a"),n("eee4")),r={name:"SpiderIndex",data:function(){return{keyword:"",intervalsDialog:!1,intervals:{},currentID:null,spiders:null,loading:!0,spidersStatus:{},clientId:this.$route.params.id,operationEnable:{2:[!1,!0],1:[!0,!1],0:[!0,!0],"-1":[!0,!1],"-2":[!1,!0]}}},components:{PanelTitle:i["a"]},created:function(){var t=this;this.onGetSpiderData(),this.$store.commit("addInterval",setInterval(function(){t.onRefreshSpidersStatus()},5e3))},methods:{onRefresh:function(){this.onGetSpiderData()},onGetSpidersStatus:function(){var t=this;this.spiders.forEach(function(e){t.onGetSpiderStatus(e.id)})},onGetSpiderStatus:function(t){var e=this;this.$set(this.spidersStatus,t,0),this.$http.get(this.formatString(this.$store.state.url.spider.status,{id:t})).then(function(n){var a=n.data.status;e.$set(e.spidersStatus,t,parseInt(a))}).catch(function(){e.$set(e.spidersStatus,t,-2)})},onGetSpiderData:function(){var t=this;this.loading=!0,this.$http.get(this.formatString(this.$store.state.url.client.listSpiders,{id:this.clientId,keyword:this.keyword})).then(function(e){var n=e.data;t.spiders=n,t.onGetSpidersStatus(),t.loading=!1}).catch(function(){t.loading=!1})},onRefreshSpidersStatus:function(){var t=this;this.spiders.forEach(function(e){t.$http.get(t.formatString(t.$store.state.url.spider.status,{id:e.id})).then(function(n){var a=n.data.status;t.$set(t.spidersStatus,e.id,parseInt(a))}).catch(function(){t.$set(t.spidersStatus,e.id,-2)})})},onSpiderUpdate:function(t,e){var n=this;this.loading=!0,this.$http.post(this.formatString(this.$store.state.url.spider.update,{id:t}),e).then(function(){n.$message.success(n.$store.getters.$lang.messages.successSave),n.onRefresh()}).catch(function(){n.$message.error(n.$store.getters.$lang.messages.errorSave),n.loading=!1})},onSpiderRunModeUpdte:function(t){if(t.next_run_duration){var e={manual:t.manual};this.onSpiderUpdate(t.id,e)}else t.manual=!t.manual,this.$message.error(this.$store.getters.$lang.messages.provideInterval)},onSpiderIntervalsUpdte:function(){var t={next_run_duration:this.intervals};this.onSpiderUpdate(this.currentID,t),this.intervalsDialog=!1},onStartSpider:function(t){var e=this;this.loading=!0,this.$http.get(this.formatString(this.$store.state.url.spider.start,{id:t})).then(function(){e.$message.success(e.$store.getters.$lang.messages.successRun),e.onRefresh()}).catch(function(){e.$message.error(e.$store.getters.$lang.messages.errorRun),e.loading=!1})},onCancelJob:function(t){var e=this;this.loading=!0,this.$http.get(this.formatString(this.$store.state.url.spider.cancelJob,{id:t})).then(function(){e.$message.success(e.$store.getters.$lang.messages.canceling),e.onRefresh()}).catch(function(){e.$message.error(e.$store.getters.$lang.messages.errorCancel),e.loading=!1})},calculatePercent:function(t){var e=t.latest_run,n=t.next_run_duration;if(!e||!n||t.manual||!t.available)return 0;var a=new Date,s=new Date(e),i=a.getTime()-s.getTime(),r=Math.floor(i/864e5);return Math.floor(r/parseInt(n)*100)},operationsEnable:function(t,e){if(!e.manual)return!0;var n=this.spidersStatus[e.id];return"run"===t?this.operationEnable[n.toString()][0]:this.operationEnable[n.toString()][1]},onJobIntervals:function(t){this.currentID=t.id,this.intervals=t.next_run_duration,this.intervalsDialog=!0},tableRowClassName:function(t){return t.row.available?"":"warning-row"}}},l=r,o=(n("5933"),n("2877")),c=Object(o["a"])(l,a,s,!1,null,null,null);e["default"]=c.exports},eee4:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"panel-title"},[t.title?n("span",{domProps:{textContent:t._s(t.title)}}):t._e(),n("div",{staticClass:"fr"},[t._t("default")],2)])},s=[],i={name:"PanelTitle",props:{title:{type:String}}},r=i,l=n("2877"),o=Object(l["a"])(r,a,s,!1,null,null,null);e["a"]=o.exports}}]);
//# sourceMappingURL=chunk-4a7237a2.368733e1.js.map