(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55d4e8a2"],{"735a":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"task-status"}},[s("el-dialog",{staticClass:"dialog",attrs:{visible:t.logDialog,size:"tiny",width:"1050px"},on:{"update:visible":function(e){t.logDialog=e}}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.objects.log}}),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.logLoading,expression:"logLoading"}],staticClass:"panel-body",staticStyle:{height:"400px",overflow:"auto"}},[s("pre",[t._v(t._s(t.logs[t.logLoadingActive]))])])],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.logDialog=!1}}},[s("i",{staticClass:"fa fa-reply"}),t._v("\n                "+t._s(t.$lang.buttons.return)+"\n            ")])],1)]),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.objects.task}}),s("div",{staticClass:"panel-body",staticStyle:{height:"260px"}},[s("el-form",{attrs:{"label-width":"110px"}},[s("el-form-item",{attrs:{label:t.$lang.columns.spider}},[[t._v("\n                                "+t._s(t.spiderInfo.name)+"\n                                "),t.spiderInfo.available?s("el-badge",{staticClass:"mark",staticStyle:{"margin-left":"3px"},attrs:{type:"success",value:t.$lang.buttons.normal}}):s("el-badge",{staticClass:"mark",staticStyle:{"margin-left":"3px"},attrs:{type:"danger",value:t.$lang.buttons.error}})]],2),s("el-form-item",{attrs:{label:t.$lang.columns.project}},[t._v(t._s(t.spiderInfo.project_name))]),s("el-form-item",{attrs:{label:t.$lang.columns.lastTime}},[t._v(t._s(t.spiderInfo.latest_run))]),s("el-form-item",{attrs:{label:t.$lang.columns.intervals}},[t._v(t._s(t.spiderInfo.next_run_duration))]),s("el-form-item",{attrs:{label:t.$lang.columns.nextTime}},[s("el-progress",{staticStyle:{"margin-top":"13px"},attrs:{percentage:t.calculatePercent(t.spiderInfo.latest_run,t.spiderInfo.next_run_duration),color:"#35CBAA"}})],1)],1)],1)],1)]),s("el-col",{attrs:{span:18}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.objects.logs}}),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"panel-body"},[s("div",{staticClass:"infinite-list-wrapper",staticStyle:{height:"260px",overflow:"auto"}},[t.jobs.length?s("el-timeline",t._l(t.jobs,function(e,i){return s("el-timeline-item",{key:i,attrs:{timestamp:e.start_time.substring(0,19),placement:"top",type:t.jobStatusClass[e.status]}},[e.spider?s("span",{staticClass:"m-l-md",style:{minWidth:"290px"}},[s("i",{staticClass:"fa fa-key"}),t._v("\n                                            "+t._s(t.$lang.columns.jobID)+" : "+t._s(e.id)+"\n                                        ")]):t._e(),e.end_time?s("span",{staticClass:"m-l-md",style:{minWidth:"190px"}},[s("i",{staticClass:"el-icon-time"}),t._v("\n                                            "+t._s(t.$lang.columns.endTime)+" : "+t._s(e.end_time.substring(0,19))+"\n                                        ")]):t._e(),s("span",{staticClass:"m-l-md"},[s("el-button",{attrs:{type:t.jobStatusClass[e.status],size:"mini"}},[["pending"].includes(e.status)?s("i",{staticClass:"fa fa-circle-thin"}):t._e(),["running"].includes(e.status)?s("i",{staticClass:"fa fa-spin fa-spinner"}):t._e(),["finished"].includes(e.status)?s("i",{staticClass:"fa fa-check"}):t._e(),t._v("\n                                                "+t._s(t.jobStatusText[e.status])+"\n                                            ")])],1),s("span",{staticClass:"m-l-md"},[s("el-button",{staticClass:"pull-right m-r-md",attrs:{type:"text",size:"mini"},on:{click:function(s){return t.onGetLog(e.id)}}},[s("a",{staticStyle:{"text-decoration":"underline"}},[t._v(t._s(t.$lang.buttons.viewLog))])])],1)])}),1):s("el-table",{staticStyle:{height:"260px",overflow:"auto"},attrs:{data:null,"empty-text":t.$lang.messages.noData}})],1)])],1)])],1)],1)],1),s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.titles.thirtyDayOperation}},[s("el-button",{attrs:{size:"mini"},on:{click:t.getMonitor}},[s("i",{staticClass:"fa fa-refresh"}),t._v("\n                "+t._s(t.$lang.buttons.refresh)+"\n            ")])],1),s("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.monitorLoading,expression:"!monitorLoading"}],staticClass:"panel-body"},[t.monitorLoading?s("div",[s("ve-histogram",{attrs:{data:t.monitor,settings:t.chartSettings}})],1):t._e()])],1)],1)},a=[],n=s("eee4"),o={name:"SpiderMonitor",data:function(){return{errorCount:0,loading:null,jobs:{},jobStatusClass:{finished:"info",running:"success",pending:"warning"},jobStatusText:{finished:this.$store.getters.$lang.buttons.finished,running:this.$store.getters.$lang.buttons.running,pending:this.$store.getters.$lang.buttons.pending},logs:{},logLoading:null,logLoadingInterval:null,logLoadingActive:null,logDialog:!1,chartSettings:{},monitorLoading:!1,monitor:{},spiderInfo:this.$route.params.spiderInfo}},components:{PanelTitle:n["a"]},created:function(){var t=this;this.monitor.columns=["run_date","page_ignore","run_times","page_error","item_scrape","item_error"],this.chartSettings={dimension:["run_date"],showLine:["run_times"],axisSite:{right:["run_times"]},scale:[!0,!0],stack:{record:["page_ignore","page_error","item_scrape","item_error"]},max:["dataMax",5],labelMap:{run_date:this.$lang.charts.runDate,page_ignore:this.$lang.charts.pageIgnore,page_error:this.$lang.charts.pageError,item_scrape:this.$lang.charts.itemScrape,item_error:this.$lang.charts.itemError,run_times:this.$lang.charts.runTimes}},this.getJobs(),this.getMonitor(),this.$store.commit("addInterval",setInterval(function(){t.getJobs()},5e3))},methods:{getJobs:function(){var t=this;this.loading=!0,this.errorCount=0,this.$http.get(this.formatString(this.$store.state.url.spider.listJobs,{id:this.spiderInfo.id})).then(function(e){var s=e.data;t.jobs=s,t.loading=!1}).catch(function(){t.loading=!1,t.errorCount+=1,t.errorCount>=3?t.$message.error(t.$store.getters.$lang.messages.errorLoad):t.$store.commit("setTimeout",setTimeout(function(){t.getJobs()},3e3))})},getLog:function(t){var e=this;t?(this.logLoading=!0,this.logLoadingActive=t,this.$http.get(this.formatString(this.$store.state.url.spider.getLog,{id:this.spiderInfo.id,job:this.logLoadingActive})).then(function(s){var i=s.data;e.$set(e.logs,e.logLoadingActive,i),e.logLoading=!1,e.$store.commit("setTimeout",setTimeout(function(){e.getLog(t)},2e3))}).catch(function(){e.logLoading=!1})):this.$store.commit("clearTimeout")},onGetLog:function(t){this.logDialog=!0,this.getLog(t)},getMonitor:function(){var t=this;this.monitorLoading=!1,this.$http.get(this.formatString(this.$store.state.url.spider.getMonitor,{id:this.spiderInfo.id})).then(function(e){var s=e.data;t.monitor.rows=s,t.monitorLoading=!0}).catch(function(){t.monitorLoading=!0})},calculatePercent:function(t,e){if(!t||!e||!this.spiderInfo.available||this.spiderInfo.manual)return 0;var s=new Date,i=new Date(t),a=s.getTime()-i.getTime(),n=Math.floor(a/864e5);return Math.floor(n/parseInt(e)*100)}}},r=o,l=s("2877"),g=Object(l["a"])(r,i,a,!1,null,null,null);e["default"]=g.exports},eee4:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"panel-title"},[t.title?s("span",{domProps:{textContent:t._s(t.title)}}):t._e(),s("div",{staticClass:"fr"},[t._t("default")],2)])},a=[],n={name:"PanelTitle",props:{title:{type:String}}},o=n,r=s("2877"),l=Object(r["a"])(o,i,a,!1,null,null,null);e["a"]=l.exports}}]);
//# sourceMappingURL=chunk-55d4e8a2.3b6e22e5.js.map