{"version":3,"sources":["webpack:///src/views/client/src/views/client/Schedule.vue","chunk-4a7237a2.b5eb0631.css"],"names":[],"mappings":"AAuRA,oBACA,uBCrRA,CDwRA,MACA,cAAA,CACA,iBCtRA,CDyRA,uBACA,kBCvRA","file":"chunk-4a7237a2.b5eb0631.css","sourcesContent":["<template>\n\t<div class=\"panel\">\n\t\t<el-dialog :visible.sync=\"intervalsDialog\" size=\"tiny\" width=\"500px\" class=\"dialog\">\n\t\t\t<el-form label-width=\"140px\">\n\t\t\t\t<el-form-item :label=\"$lang.columns.intervals\">\n\t\t\t\t\t<el-input v-model=\"intervals\" :placeholder=\"$lang.columns.days\"></el-input>\n\t\t\t\t</el-form-item>\n\t\t\t</el-form>\n\t\t\t<div slot=\"footer\">\n\t\t\t\t<el-button @click=\"intervalsDialog=false\" size=\"small\">\n\t\t\t\t\t{{ $lang.buttons.cancel }}\n\t\t\t\t</el-button>\n\t\t\t\t<el-button @click=\"onSpiderIntervalsUpdte\" type=\"primary\" size=\"small\">\n\t\t\t\t\t{{ $lang.buttons.save }}\n\t\t\t\t</el-button>\n\t\t\t</div>\n\t\t</el-dialog>\n\n\t\t<panel-title :title=\"$lang.objects.spiders\">\n\t\t\t<el-input v-model=\"keyword\" :placeholder=\"$lang.inputs.search\" prefix-icon=\"el-icon-search\" size=\"mini\" @input=\"onGetSpiderData\" style=\"width:160px; margin-right:10px\"/>\n\t\t\t<el-button @click=\"onRefresh\" size=\"mini\">\n\t\t\t\t<i class=\"fa fa-refresh\"></i>\n\t\t\t\t{{ $lang.buttons.refresh }}\n\t\t\t</el-button>\n\t\t</panel-title>\n\t\t<div class=\"panel-body\">\n\t\t\t<el-table :empty-text=\"$lang.messages.noData\" :data=\"spiders\" v-loading=\"loading\" :element-loading-text=\"$lang.messages.loading\" :row-class-name=\"tableRowClassName\" max-height=\"700\">\n\t\t\t\t<el-table-column align=\"center\" prop=\"id\" :label=\"$lang.columns.id\" width=\"80\"/>\n\t\t\t\t<el-table-column align=\"center\" :label=\"$lang.columns.name\" width=\"200\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t{{ props.row.name }}\n\t\t\t\t\t\t<el-badge v-if=\"props.row.available\" class=\"mark\" type=\"success\" :value=\"$lang.buttons.normal\" style=\"margin-left:3px\"/>\n\t\t\t\t\t\t<el-badge v-else class=\"mark\" type=\"danger\" :value=\"$lang.buttons.error\" style=\"margin-left:3px\"/>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t\t<el-table-column align=\"center\" :label=\"$lang.columns.project\" width=\"180\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t<i class=\"el-icon-document-copy\" style=\"margin-right:6px\"></i>\n\t\t\t\t\t\t<span>{{ props.row.project_name }}</span>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t\t<el-table-column align=\"center\" prop=\"manual\" :label=\"$lang.columns.runMode\" width=\"200\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t<span v-if=\"props.row.manual\" style=\"color:#9c9c9c; margin-right:8px;\">{{ $lang.selects.manual }}</span>\n\t\t\t\t\t\t<span v-else style=\"color:#9c9c9c; margin-right:8px;\">{{ $lang.selects.auto }}</span>\n\t\t\t\t\t\t<el-switch\n\t\t\t\t\t\t\t\tv-model=\"spiders[props.$index].manual\"\n\t\t\t\t\t\t\t\tactive-color=\"#E6A23C\"\n\t\t\t\t\t\t\t\tinactive-color=\"#60BCFE\"\n\t\t\t\t\t\t\t\t:active-value=\"true\"\n\t\t\t\t\t\t\t\t:inactive-value=\"false\"\n\t\t\t\t\t\t\t\t@change=\"onSpiderRunModeUpdte(props.row)\">\n\t\t\t\t\t\t</el-switch>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t\t<el-table-column align=\"center\" :label=\"$lang.columns.nextTime\" width=\"250\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t<el-progress :percentage=\"calculatePercent(props.row)\" color=\"#35CBAA\" :show-text=\"false\"></el-progress>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t\t<el-table-column align=\"center\" :label=\"$lang.columns.status\" width=\"180\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t<span v-if=\"spidersStatus[props.row.id] === 2\" style=\"color:#409EFF; font-weight:bold\">\n\t\t\t\t\t\t\t<i class=\"fa fa-circle\" style=\"margin-right:5px\"></i>\n\t\t\t\t\t\t\t{{ $lang.buttons.finished }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-else-if=\"spidersStatus[props.row.id] === 1\" style=\"color:#67C23A; font-weight:bold\">\n\t\t\t\t\t\t\t<i class=\"el-icon-loading\" style=\"margin-right:5px\"></i>\n\t\t\t\t\t\t\t{{ $lang.buttons.running }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-else-if=\"spidersStatus[props.row.id] === 0\" style=\"color:#E6A23C; font-weight:bold\">\n\t\t\t\t\t\t\t<i class=\"el-icon-loading\" style=\"margin-right:5px\"></i>\n\t\t\t\t\t\t\t{{ $lang.buttons.connecting }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-else-if=\"spidersStatus[props.row.id] === -1\" style=\"color:#E6A23C; font-weight:bold\">\n\t\t\t\t\t\t\t<i class=\"el-icon-loading\" style=\"margin-right:5px\"></i>\n\t\t\t\t\t\t\t{{ $lang.buttons.pending }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-else style=\"color:#F56C6C; font-weight:bold\">\n\t\t\t\t\t\t\t<i class=\"fa fa-circle\" style=\"margin-right:5px\"></i>\n\t\t\t\t\t\t\t{{ $lang.buttons.noJob }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t\t<el-table-column align=\"center\" :label=\"$lang.columns.operations\">\n\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t<el-tooltip :content=\"$lang.tags.run\" placement=\"top\">\n\t\t\t\t\t\t\t<el-button type=\"text\" size=\"mini\" icon=\"fa fa-play fa-2x\" style=\"color:#35CBAA\" @click=\"onStartSpider(props.row.id)\" :disabled=\"operationsEnable('run', props.row)\"/>\n\t\t\t\t\t\t</el-tooltip>\n\t\t\t\t\t\t<span style=\"margin-right:40px;\"></span>\n\t\t\t\t\t\t<el-tooltip :content=\"$lang.tags.cancel\" placement=\"top\">\n\t\t\t\t\t\t\t<el-button type=\"text\" size=\"mini\" icon=\"fa fa-times fa-2x\" style=\"color:#EF6372\" @click=\"onCancelJob(props.row.id)\" :disabled=\"operationsEnable('cancel', props.row)\"/>\n\t\t\t\t\t\t</el-tooltip>\n\t\t\t\t\t\t<span style=\"margin-right:40px;\"></span>\n\t\t\t\t\t\t<el-tooltip :content=\"$lang.tags.intervals\" placement=\"top\">\n\t\t\t\t\t\t\t<el-button type=\"text\" size=\"mini\" icon=\"fa el-icon-alarm-clock fa-2x\" style=\"color:#606266\" @click=\"onJobIntervals(props.row)\"/>\n\t\t\t\t\t\t</el-tooltip>\n\t\t\t\t\t\t<span style=\"margin-right:40px;\"></span>\n\t\t\t\t\t\t<router-link :to=\"{name: 'SpiderMonitor', params: {spiderInfo: props.row}}\" tag=\"span\">\n\t\t\t\t\t\t\t<el-tooltip :content=\"$lang.tags.monitor\" placement=\"top\">\n\t\t\t\t\t\t\t\t<i class=\"fa-2x el-icon-notebook-2\"></i>\n\t\t\t\t\t\t\t</el-tooltip>\n\t\t\t\t\t\t</router-link>\n\t\t\t\t\t</template>\n\t\t\t\t</el-table-column>\n\t\t\t</el-table>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n\timport PanelTitle from '../../components/PanelTitle'\n\n\texport default {\n\t\tname: 'SpiderIndex',\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tkeyword: '',\n\t\t\t\tintervalsDialog: false,\n\t\t\t\tintervals: {},\n\t\t\t\tcurrentID: null,\n\t\t\t\tspiders: null,\n\t\t\t\tloading: true,\n\t\t\t\tspidersStatus: {},\n\t\t\t\tclientId: this.$route.params.id,\n\t\t\t\toperationEnable: {\n\t\t\t\t\t'2': [false, true],\n\t\t\t\t\t'1': [true, false],\n\t\t\t\t\t'0': [true, true],\n\t\t\t\t\t'-1': [true, false],\n\t\t\t\t\t'-2': [false, true]\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomponents: {\n\t\t\tPanelTitle,\n\t\t},\n\t\tcreated() {\n\t\t\tthis.onGetSpiderData();\n\t\t\tthis.$store.commit(\n\t\t\t\t\t'addInterval',\n\t\t\t\t\tsetInterval(() => {\n\t\t\t\t\t\tthis.onRefreshSpidersStatus()\n\t\t\t\t\t}, 5000)\n\t\t\t)\n\t\t},\n\t\tmethods: {\n\t\t\tonRefresh() {\n\t\t\t\tthis.onGetSpiderData()\n\t\t\t},\n\t\t\tonGetSpidersStatus() {\n\t\t\t\tthis.spiders.forEach((spider) => {\n\t\t\t\t\tthis.onGetSpiderStatus(spider.id)\n\t\t\t\t})\n\t\t\t},\n\t\t\tonGetSpiderStatus(id) {\n\t\t\t\tthis.$set(this.spidersStatus, id, 0);\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.spider.status, {\n\t\t\t\t\tid: id\n\t\t\t\t})).then(({data: {status: result}}) => {\n\t\t\t\t\tthis.$set(this.spidersStatus, id, parseInt(result));\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$set(this.spidersStatus, id, -2)\n\t\t\t\t})\n\t\t\t},\n\t\t\tonGetSpiderData() {\n\t\t\t\tthis.loading = true;\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.client.listSpiders, {\n\t\t\t\t\tid: this.clientId,\n\t\t\t\t\tkeyword: this.keyword,\n\t\t\t\t})).then(({data: spiders}) => {\n\t\t\t\t\tthis.spiders = spiders;\n\t\t\t\t\tthis.onGetSpidersStatus();\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tonRefreshSpidersStatus() {\n\t\t\t\tthis.spiders.forEach((spider) => {\n\t\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.spider.status, {\n\t\t\t\t\t\tid: spider.id\n\t\t\t\t\t})).then(({data: {status: result}}) => {\n\t\t\t\t\t\tthis.$set(this.spidersStatus, spider.id, parseInt(result));\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\tthis.$set(this.spidersStatus, spider.id, -2)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tonSpiderUpdate(id, data) {\n\t\t\t\tthis.loading = true;\n\t\t\t\tthis.$http.post(\n\t\t\t\t\t\tthis.formatString(this.$store.state.url.spider.update, {id: id}),\n\t\t\t\t\t\tdata\n\t\t\t\t).then(() => {\n\t\t\t\t\tthis.$message.success(this.$store.getters.$lang.messages.successSave);\n\t\t\t\t\tthis.onRefresh()\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.errorSave);\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tonSpiderRunModeUpdte(row) {\n\t\t\t\tif (row.next_run_duration){\n\t\t\t\t\tconst data = {'manual': row.manual};\n\t\t\t\t\tthis.onSpiderUpdate(row.id, data)\n\t\t\t\t} else {\n\t\t\t\t\trow.manual = !row.manual;\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.provideInterval);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonSpiderIntervalsUpdte() {\n\t\t\t\tconst data = {'next_run_duration': this.intervals};\n\t\t\t\tthis.onSpiderUpdate(this.currentID, data);\n\t\t\t\tthis.intervalsDialog = false;\n\t\t\t},\n\t\t\tonStartSpider(id) {\n\t\t\t\tthis.loading = true;\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.spider.start, {\n\t\t\t\t\tid: id\n\t\t\t\t})).then(() => {\n\t\t\t\t\tthis.$message.success(this.$store.getters.$lang.messages.successRun);\n\t\t\t\t\tthis.onRefresh()\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.errorRun);\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tonCancelJob(id) {\n\t\t\t\tthis.loading = true;\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.spider.cancelJob, {\n\t\t\t\t\tid: id\n\t\t\t\t})).then(() => {\n\t\t\t\t\tthis.$message.success(this.$store.getters.$lang.messages.canceling);\n\t\t\t\t\tthis.onRefresh()\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.errorCancel);\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tcalculatePercent(row) {\n\t\t\t\tconst latest = row.latest_run;\n\t\t\t\tconst duration = row.next_run_duration;\n\t\t\t\tif (!latest || !duration || row.manual || !row.available) {\n\t\t\t\t\treturn 0\n\t\t\t\t}\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst latest_run = new Date(latest);\n\t\t\t\tconst now_duration = now.getTime() - latest_run.getTime();\n\t\t\t\tconst days = Math.floor(now_duration / (24 * 3600 * 1000));\n\t\t\t\treturn Math.floor(days / parseInt(duration) * 100);\n\t\t\t},\n\t\t\toperationsEnable(type, row){\n\t\t\t\tif(!row.manual){\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\tconst status = this.spidersStatus[row.id];\n\t\t\t\tif(type === 'run'){\n\t\t\t\t\treturn this.operationEnable[status.toString()][0]\n\t\t\t\t} else {\n\t\t\t\t\treturn this.operationEnable[status.toString()][1]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonJobIntervals(row){\n\t\t\t\tthis.currentID = row.id;\n\t\t\t\tthis.intervals = row.next_run_duration;\n\t\t\t\tthis.intervalsDialog = true;\n\t\t\t},\n\t\t\ttableRowClassName(data) {\n\t\t\t\tif (!data.row.available) {\n\t\t\t\t\treturn 'warning-row';\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.el-button:disabled{\n\t\tcolor: #e8ebf1 !important;\n\t}\n\n\t.item {\n\t\tmargin-top: 5px;\n\t\tmargin-right: 40px;\n\t}\n\n\t.el-table .warning-row {\n\t\tbackground: oldlace;\n\t}\n</style>","\n.el-button:disabled{\n\tcolor: #e8ebf1 !important;\n}\n.item {\n\tmargin-top: 5px;\n\tmargin-right: 40px;\n}\n.el-table .warning-row {\n\tbackground: oldlace;\n}\n\n\n/*# sourceMappingURL=chunk-4a7237a2.b5eb0631.css.map*/"]}